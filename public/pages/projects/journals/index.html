<!doctype html>
<html lang="en-GB" prefix="
  dcterms: http://purl.org/dc/terms/
  schema:  https://schema.org/
">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title property="dcterms:title">Reflexive Journal &amp; Analysis &mdash; ResearchOps</title>
	<meta property="dcterms:creator" content="Home Office Biometrics">
	<link rel="stylesheet" href="/css/govuk/govuk-typography.css">
	<link rel="stylesheet" href="/css/govuk/govuk-colours.css">
	<link rel="stylesheet" href="/css/screen.css">
	<link rel="stylesheet" href="/css/journal.css">

	<!-- Components/layout first -->
	<script type="module" src="/components/layout.js" defer></script>
</head>

<body typeof="schema:WebPage">
	<!-- Global header -->
	<x-include src="/partials/header.html" vars='{
		"active":"Projects",
		"subtitle":"Research Analysis"
	}'></x-include>

	<nav class="breadcrumbs" aria-label="Breadcrumb">
		<a href="/pages/projects/">Projects</a> &rarr;
		<a href="#" id="project-link">Project Dashboard</a> &rarr;
		<span>Journal &amp; Analysis</span>
	</nav>

	<header role="banner" class="journal-header">
		<div>
			<h2 property="dcterms:title">Reflexive Journal &amp; Analysis</h2>
			<p class="hint">Document and analyze your research journey</p>
		</div>
	</header>

	<!-- Tab navigation -->
	<nav class="analysis-tabs" role="tablist" aria-label="Analysis views">
		<button role="tab" aria-selected="true" aria-controls="journal-panel" id="journal-tab">
			Journal Entries
		</button>
		<button role="tab" aria-selected="false" aria-controls="codes-panel" id="codes-tab">
			Codes
		</button>
		<button role="tab" aria-selected="false" aria-controls="memos-panel" id="memos-tab">
			Memos
		</button>
		<button role="tab" aria-selected="false" aria-controls="analysis-panel" id="analysis-tab">
			Analysis
		</button>
	</nav>

	<main id="content" role="main">

		<!-- Journal Panel (default visible) -->
		<div role="tabpanel" id="journal-panel" aria-labelledby="journal-tab">

			<div class="panel-header">
				<button type="button" class="btn" id="toggle-form-btn">
					+ New entry
				</button>
			</div>

			<!-- Entry form (initially hidden) -->
			<section class="entry-form" id="entry-form" hidden>
				<h3 id="form-heading">Add journal entry</h3>
				<form id="add-entry-form" novalidate>

					<div class="form-group">
						<label for="entry-category">
							Category
							<span aria-hidden="true">*</span>
						</label>
						<select id="entry-category" name="category" required aria-required="true">
							<option value="perceptions">Evolving perceptions</option>
							<option value="procedures">Day-to-day procedures</option>
							<option value="decisions">Methodological decision points</option>
							<option value="introspections">Personal introspections</option>
						</select>
						<span class="hint">Select the type of reflection</span>
					</div>

					<div class="form-group">
						<label for="entry-content">
							Entry
							<span aria-hidden="true">*</span>
						</label>
						<textarea id="entry-content" name="content" rows="8" required aria-required="true" aria-describedby="content-hint"></textarea>
						<span class="hint" id="content-hint">Write freely; this is a private space for research reflection</span>
					</div>

					<div class="form-group">
						<label for="entry-tags">Tags (optional)</label>
						<input type="text" id="entry-tags" name="tags" placeholder="e.g. recruitment, ethics, bias">
						<span class="hint">Comma-separated keywords for easier retrieval</span>
					</div>

					<div style="display: flex; gap: var(--space-200);">
						<button type="submit" class="btn">Save entry</button>
						<button type="button" class="btn-secondary" id="cancel-form-btn">Cancel</button>
					</div>

					<div id="form-status" class="status" aria-live="polite" aria-atomic="true"></div>
				</form>
			</section>

			<!-- Filter controls -->
			<section aria-label="Filter entries">
				<div class="filter-group" role="group" aria-label="Filter by category">
					<button type="button" class="filter-btn active" data-filter="all">All entries</button>
					<button type="button" class="filter-btn" data-filter="perceptions">Perceptions</button>
					<button type="button" class="filter-btn" data-filter="procedures">Procedures</button>
					<button type="button" class="filter-btn" data-filter="decisions">Decisions</button>
					<button type="button" class="filter-btn" data-filter="introspections">Introspections</button>
				</div>
			</section>

			<!-- Journal entries -->
			<section aria-labelledby="entries-heading" aria-live="polite">
				<h3 id="entries-heading" class="visually-hidden">Journal entries</h3>
				<div class="journal-entries" id="entries-container">
					<div class="empty-journal">
						<div class="empty-journal-icon" aria-hidden="true">üìî</div>
						<p><strong>No entries yet</strong></p>
						<p>Start documenting your research journey by adding your first journal entry.</p>
					</div>
				</div>
			</section>
		</div>

		<!-- Codes Panel -->
		<div role="tabpanel" id="codes-panel" aria-labelledby="codes-tab" hidden>
			<div class="panel-header">
				<h3>Codebook Management</h3>
				<button type="button" class="btn" id="new-code-btn">+ Add Code</button>
			</div>

			<!-- Code form (initially hidden) -->
			<section class="code-form" id="code-form" hidden>
				<h4>Add new code</h4>
				<form id="add-code-form" novalidate>
					<div class="form-group">
						<label for="code-name">Code name <span aria-hidden="true">*</span></label>
						<input type="text" id="code-name" name="name" required aria-required="true">
					</div>

					<div class="form-group">
						<label for="code-definition">Definition</label>
						<textarea id="code-definition" name="definition" rows="3"></textarea>
						<span class="hint">Describe when to use this code</span>
					</div>

					<div class="form-group">
						<label for="code-color">Color</label>
						<input type="color" id="code-color" name="color" value="#1d70b8">
					</div>

					<div class="form-group">
						<label for="parent-code">Parent code (optional)</label>
						<select id="parent-code" name="parent">
							<option value="">None (top-level code)</option>
						</select>
					</div>

					<div style="display: flex; gap: var(--space-200);">
						<button type="submit" class="btn">Save Code</button>
						<button type="button" class="btn-secondary" id="cancel-code-btn">Cancel</button>
					</div>
				</form>
			</section>

			<div class="codebook-display" id="codebook-display">
				<!-- Hierarchical code tree rendered here -->
			</div>
		</div>

		<!-- Memos Panel -->
		<div role="tabpanel" id="memos-panel" aria-labelledby="memos-tab" hidden>
			<div class="panel-header">
				<h3>Research Memos</h3>
				<button type="button" class="btn" id="new-memo-btn">+ New Memo</button>
			</div>

			<!-- Memo form (initially hidden) -->
			<section class="memo-form" id="memo-form" hidden>
				<h4>Create memo</h4>
				<form id="add-memo-form" novalidate>
					<div class="form-group">
						<label for="memo-type">Memo type <span aria-hidden="true">*</span></label>
						<select id="memo-type" name="memo_type" required aria-required="true">
							<option value="analytical">Analytical</option>
							<option value="methodological">Methodological</option>
							<option value="theoretical">Theoretical</option>
							<option value="reflexive">Reflexive</option>
						</select>
					</div>

					<div class="form-group">
						<label for="memo-title">Title</label>
						<input type="text" id="memo-title" name="title">
					</div>

					<div class="form-group">
						<label for="memo-content">Content <span aria-hidden="true">*</span></label>
						<textarea id="memo-content" name="content" rows="10" required aria-required="true"></textarea>
					</div>

					<div style="display: flex; gap: var(--space-200);">
						<button type="submit" class="btn">Save Memo</button>
						<button type="button" class="btn-secondary" id="cancel-memo-btn">Cancel</button>
					</div>
				</form>
			</section>

			<div class="memo-filters">
				<button type="button" class="filter-btn active" data-memo-filter="all">All</button>
				<button type="button" class="filter-btn" data-memo-filter="analytical">Analytical</button>
				<button type="button" class="filter-btn" data-memo-filter="methodological">Methodological</button>
				<button type="button" class="filter-btn" data-memo-filter="theoretical">Theoretical</button>
				<button type="button" class="filter-btn" data-memo-filter="reflexive">Reflexive</button>
			</div>

			<div class="memos-list" id="memos-container">
				<!-- Memos rendered here -->
			</div>
		</div>

		<!-- Analysis Panel -->
		<div role="tabpanel" id="analysis-panel" aria-labelledby="analysis-tab" hidden>
			<div class="analysis-tools">
				<h3>Analysis Tools</h3>

				<div class="analysis-options">
					<button type="button" class="analysis-btn" data-analysis="timeline">
						üìä Timeline View
					</button>
					<button type="button" class="analysis-btn" data-analysis="co-occurrence">
						üîó Code Co-occurrence
					</button>
					<button type="button" class="analysis-btn" data-analysis="retrieval">
						üîç Code Retrieval
					</button>
					<button type="button" class="analysis-btn" data-analysis="export">
						üì§ Export Analysis
					</button>
				</div>
			</div>

			<div class="analysis-view" id="analysis-container">
				<!-- Analysis visualisations rendered here -->
			</div>
		</div>

	</main>

	<!-- Coding panel (initially hidden, overlays content) -->
	<aside id="coding-panel" class="coding-panel" hidden aria-label="Apply codes">
		<div class="panel-header">
			<h3>Apply Codes</h3>
			<button type="button" class="close-panel" aria-label="Close coding panel">‚úï</button>
		</div>

		<div class="selected-text-preview">
			<h4>Selected text:</h4>
			<blockquote id="selected-text-display"></blockquote>
		</div>

		<div class="code-search">
			<label for="code-search-input" class="visually-hidden">Search codes</label>
			<input type="search" id="code-search-input" placeholder="Search codes&hellip;">
		</div>

		<div class="codebook-tree" id="coding-codebook" role="tree">
			<!-- Code list for selection -->
		</div>

		<div class="coding-confidence">
			<fieldset>
				<legend>Confidence level</legend>
				<label>
					<input type="radio" name="confidence" value="low">
					Low
				</label>
				<label>
					<input type="radio" name="confidence" value="medium" checked>
					Medium
				</label>
				<label>
					<input type="radio" name="confidence" value="high">
					High
				</label>
			</fieldset>
		</div>

		<div class="coding-memo">
			<label for="coding-memo-input">Coding memo (optional)</label>
			<textarea id="coding-memo-input" rows="3" placeholder="Why this code? Any reflections?"></textarea>
		</div>

		<div class="panel-actions">
			<button type="button" class="btn" id="apply-code-btn">Apply Code</button>
			<button type="button" class="btn-secondary" id="cancel-coding-btn">Cancel</button>
		</div>
	</aside>

	<x-include src="/partials/footer.html"></x-include>
	<script type="module" src="/js/caqdas-interface.js" defer></script>
</body>

</html>
