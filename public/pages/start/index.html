<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="sda-auto" content="true" />
	<title>Start a New Research Project — ResearchOps Demo Suite</title>

	<link rel="stylesheet" href="/css/govuk/govuk-typography.css" media="screen" />
	<link rel="stylesheet" href="/css/govuk/govuk-colours.css" media="screen" />
	<link rel="stylesheet" href="/css/screen.css" media="screen" />

	<!-- Components/layout first -->
	<script type="module" src="/components/layout.js" defer></script>

	<!-- Step 1 owner: imports copilot-suggester internally and sets window.__descAssistActive -->
	<script type="module" src="/js/start-description-assist.js" defer></script>
	
	<!-- Step 2 owner: wires objectives AI & rule suggestions -->
	<script type="module" src="/js/start-objectives-assist.js" defer></script>

	<!-- Main page controller: respects window.__descAssistActive and will not double-wire Step 1 -->
	<script type="module" src="start-new-project.js" defer></script>
</head>

<body>
	<x-include src="/partials/debug-boot.html" debug-only></x-include>
	<x-include src="/partials/header.html" vars='{
			"active":"Start Research Project",
			"subtitle":"Define service phase, set status, add stakeholders and objectives"
		}'>
	</x-include>

	<main class="govuk-body" role="main">
		<div class="card">
			<h1 class="govuk-heading-l" style="margin-top:0">Start a new research project</h1>
			<p class="lede">
				Define the project within a service phase and current status, then capture stakeholders and initial objectives.
			</p>

			<!-- Step 1 -->
			<section id="step1">
				<h2 class="govuk-heading-m">Step 1 of 3</h2>
				<p class="lede">Define the project’s service phase and status</p>

				<div id="error-summary" class="panel" style="display:none" role="alert" aria-live="polite"></div>

				<form id="projectForm" novalidate>
					<label class="govuk-body" for="p_name">Project name</label>
					<input id="p_name" class="govuk-input" required aria-required="true" aria-invalid="false" />
					<p id="p_name_error" class="error-message" style="display:none"></p>

					<label class="govuk-body" for="p_desc">Description</label>
					<p id="p_desc_help" class="hint">Write what you plan to research. Do not include personal data.</p>
					<textarea id="p_desc" class="govuk-input" required aria-required="true" aria-invalid="false" aria-describedby="p_desc_help"></textarea>
					<p id="p_desc_error" class="error-message" style="display:none"></p>

					<!-- Description assistance controls -->
					<div id="ai-tools" class="toolbar mt-2 hidden" aria-label="Description assistance">
						<button class="btn btn--outline" id="btn-ai-rewrite" type="button">Try AI rewrite</button>
						<small id="ai-rewrite-status" class="mono muted" aria-live="polite"></small>
					</div>

					<!-- Rule-based suggestions (client only) -->
					<div id="description-suggestions" class="mt-2" aria-live="polite"></div>

					<!-- AI output (summary + suggestions + optional rewrite) -->
					<div id="ai-rewrite-output" class="mt-2" aria-live="polite"></div>

					<label class="govuk-body" for="p_phase">Service phase</label>
					<select id="p_phase" class="govuk-input">
						<option value="pre-discovery">Pre-Discovery</option>
						<option value="discovery">Discovery</option>
						<option value="alpha">Alpha</option>
						<option value="beta">Beta</option>
						<option value="live">Live</option>
						<option value="retired">Retired</option>
					</select>

					<label class="govuk-body" for="p_status">Project status</label>
					<select id="p_status" class="govuk-input">
						<option value="goal-setting">Goal setting &amp; problem defining</option>
						<option value="planning">Planning research</option>
						<option value="conducting">Conducting research</option>
						<option value="synthesis">Synthesis &amp; analysis</option>
						<option value="shared">Shared &amp; socialised research</option>
						<option value="monitoring">Monitoring metrics</option>
					</select>

					<div class="cta">
						<button class="govuk-button" id="next2" type="button">Continue</button>
					</div>
				</form>
			</section>

			<!-- Step 2 -->
			<section id="step2" style="display:none">
				<h2 class="govuk-heading-m">Step 2 of 3</h2>
				<p class="lede">Define the project’s stakeholders, objectives, and user groups</p>

				<form id="targetForm">

					<label class="govuk-body">Stakeholders (name | role | email, one per line)
						<textarea id="p_stakeholders" class="govuk-input"></textarea>
					</label>

					<div class="form-group">
						<label for="p_objectives">Initial objectives</label>
						<p class="hint">List your research objectives. Keep them action-oriented. Avoid personal data.</p>
						<textarea id="p_objectives" name="p_objectives" rows="5"></textarea>
						<div id="ai-objectives-tools" class="toolbar mt-2 hidden" aria-label="Objectives assistance">
							<button class="btn btn--secondary" id="btn-obj-suggestions" type="button">Get suggestions</button>
							<button class="btn btn--outline" id="btn-obj-ai-rewrite" type="button">Try AI rewrite</button>
							<small id="ai-obj-status" class="mono muted" aria-live="polite"></small>
						</div>
					</div>

					<!-- Rule-based/AI suggestions (Objectives) -->
					<div id="objectives-suggestions" class="mt-2" aria-live="polite"></div>

					<!-- AI rewrite preview (Objectives) -->
					<div id="ai-objectives-output" class="mt-2" aria-live="polite"></div>

					<label class="govuk-body">User groups (comma-separated)
						<input id="p_usergroups" class="govuk-input" />
					</label>

					<div class="cta">
						<button class="govuk-button" id="prev1" type="button">Back</button>
						<button class="govuk-button" id="next3" type="button">Continue</button>
					</div>
				</form>
			</section>

			<!-- Step 3 -->
			<section id="step3" style="display:none">
				<h2 class="govuk-heading-m">Step 3 of 3</h2>
				<p class="lede">Supplementary information about the project</p>

				<form id="researchForm">
					<label class="govuk-body">Lead Researcher
						<input id="lead_name" class="govuk-input" value="" />
					</label>

					<label class="govuk-body">Researcher&rsquo;s Email
						<input id="lead_email" type="email" class="govuk-input" value="" />
					</label>

					<label class="govuk-body">Notes
						<textarea id="p_notes" class="govuk-input"></textarea>
					</label>

					<div class="cta">
						<button class="govuk-button" id="prev2" type="button">Back</button>
						<button class="govuk-button" id="finish" type="button">Create project</button>
					</div>
				</form>
			</section>
		</div>
	</main>

	<!-- Global footer -->
	<x-include src="/partials/footer.html"></x-include>
</body>

</html>
