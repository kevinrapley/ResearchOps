/* ==========================================================================
   ResearchOps UI • Guides stylesheet (scoped)
   Version:    v1.3.0
   Service:    Home Office Biometrics — ResearchOps
   Author:     Kevin Rapley
   Date:       2025-10-07
   Build:      GOV.UK typography + colours; mobile-first
   Repo:       /css/guides.css
   License:    All rights reserved
   NAV KEY:    "="  (Find "=" to jump sections)
   ========================================================================== */

/* CSS DIRECTORY
	1. = TOKENS
	2. = LAYOUT
	3. = LIST HEADER (above table)
	4. = EDITOR (header, toolbar row, inputs)
	5. = SPLIT PANES (source + preview)
	6. = LINT OUTPUT
	7. = MENUS (export dropdown)
	8. = DRAWERS (patterns, variables)
	9. = FORMS
	10. = RESPONSIVE
*/

/* === =TOKENS ============================================= */
:root {
	--guides-border: #d0d7de;
	--guides-shadow: rgba(0,0,0,.08);
	--guides-bg: #fff;
	--guides-control-h: 36px;
	--guides-gap: 10px;
	--guide-source-base-h: 550px;
	}

/* === =LAYOUT ============================================= */
.page-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: 16px;
	margin-bottom: 12px;
	}

.page-header__titles .muted {
	margin: 6px 0 0 0;
	}

.divider {
	border: 0;
	border-top: 1px solid var(--guides-border);
	margin: 16px 0;
	}

/* === =LIST HEADER (ABOVE TABLE) ========================== */
/* “Guides for this study” + New / Import / Back — all on one baseline */
.guides-header {
	display: flex;
	align-items: baseline;
	justify-content: space-between;
	gap: var(--guides-gap);
	margin: 8px 0 12px;
	}

.guides-header .govuk-heading-m {
	margin: 0;
	}

.guides-header .toolbar {
	display: flex;
	align-items: baseline;
	gap: var(--guides-gap);
	white-space: nowrap;
	}

.guides-header .toolbar .btn {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	height: var(--guides-control-h);
	padding: 0 12px;
	line-height: 1;
	}

/* === =EDITOR ============================================= */
.editor {
	display: grid;
	grid-template-rows: auto auto 1fr;
	gap: 12px;
	min-height: 60vh;
	}

.editor__header {
	display: flex;
	align-items: baseline;
	justify-content: space-between;
	gap: 12px;
	}

/* Editor toolbar sits under editor header and above split panes */
.editor__toolbar {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: var(--guides-gap);
	margin-top: -4px;
	}

/* Two groups: left (Tag/Pattern/Variables) and right (Save/Publish/Export/Title) */
.toolbar-group {
	display: inline-flex;
	align-items: center;
	gap: var(--guides-gap);
	flex-wrap: nowrap;
	}

.toolbar-group--left {
	flex: 0 0 auto;
	}

.toolbar-group--right {
	flex: 0 0 auto;
	}

/* Normalise heights for buttons and inputs in editor toolbar */
.editor__toolbar .btn,
.editor__toolbar input[type="text"],
.editor__toolbar input[type="search"],
.editor__toolbar select {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	height: var(--guides-control-h);
	padding: 0 12px;
	line-height: 1;
	box-sizing: border-box;
	white-space: nowrap;
	}

/* Right-side “Guide title” label + input */
.label-inline {
	display: inline-flex;
	align-items: center;
	height: var(--guides-control-h);
	margin-right: 6px;
	}

#guide-title {
	width: 300px;
	max-width: 420px;
	}

/* Optional large title input style (for reuse elsewhere) */
.input--title {
	font-size: 1.25rem;
	font-weight: 600;
	padding: 8px 10px;
	}

/* === =SPLIT PANES ======================================== */
/* Fixed heights with vertical overflow:
   Both Source and Preview are (base Source height + 150px). */
#guide-source,
#guide-preview {
	height: var(--guide-source-base-h);
	min-height: 0;
	padding: 12px;
	overflow-y: auto;
	box-sizing: border-box;
	-webkit-overflow-scrolling: touch;
	}

#guide-source {
	resize: none;
	}

.editor__split {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 12px;
	}

.pane {
	display: flex;
	flex-direction: column;
	}

.code {
	font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
	line-height: 1.5;
	}

/* Only apply styles when it's a direct textarea */
textarea.code {
	padding: 12px;
	border: 1px solid var(--guides-border);
	border-radius: 4px;
	background: #ffffff;
	}

.preview {
	border: 1px solid var(--guides-border);
	border-radius: 4px;
	padding: 12px;
	min-height: 0;
	overflow: auto;
	background: var(--guides-bg);
	box-sizing: border-box;
	}
	
/* === CODE EDITOR WITH SYNTAX HIGHLIGHTING =============== */
.code-editor {
	position: relative;
	width: 100%;
	height: 550px; /* Fixed height */
	border: 1px solid #b1b4b6;
	border-radius: 4px;
	background: #ffffff;
	overflow: hidden; /* Container clips both layers */
	}

/* Highlight backdrop - shows colored syntax */
.code-editor__highlight {
	position: absolute;
	top: -24px;
	left: 0;
	width: 100%;
	height: 100%;
	padding: 12px;
	margin: 0;
	border: 0;
	overflow: auto;
	pointer-events: none; /* Click through to textarea */
	
	/* Typography - must match textarea exactly */
	font-family: 'Courier New', Courier, monospace;
	font-size: 14px;
	font-weight: normal;
	line-height: 1.5;
	letter-spacing: 0;
	word-spacing: 0;
	
	/* Text behavior - must match textarea exactly */
	white-space: pre-wrap;
	word-wrap: break-word;
	overflow-wrap: break-word;
	word-break: normal;
	tab-size: 4;
	-moz-tab-size: 4;
	
	color: #0b0c0c; /* Visible colored text */
	background: transparent;
	z-index: 1;
	
	/* Hide scrollbars but keep scroll capability */
	scrollbar-width: none;
	-ms-overflow-style: none;
	}

.code-editor__highlight::-webkit-scrollbar {
	display: none;
	width: 0;
	height: 0;
	}

.code-editor__highlight pre {
	margin: 0;
	padding: 0;
	border: 0;
	background: transparent;
	font: inherit;
	white-space: inherit;
	word-wrap: inherit;
	}

.code-editor__highlight code {
	display: block;
	margin: 0;
	padding: 0;
	border: 0;
	background: transparent;
	font: inherit;
	white-space: inherit;
	word-wrap: inherit;
	text-shadow: none;
	}

/* Textarea - interactive layer with transparent text */
.code-editor__textarea {
	position: absolute; /* ← Must be absolute */
	top: 18px;
	left: 0;
	width: 100%;
	height: 100%;
	padding: 12px;
	margin: 0;
	border: 0;
	box-sizing: border-box;
	
	/* Typography - must match highlight exactly */
	font-family: 'Courier New', Courier, monospace;
	font-size: 14px;
	font-weight: normal;
	line-height: 1.5;
	letter-spacing: 0;
	word-spacing: 0;
	
	/* Text behavior - must match highlight exactly */
	white-space: pre-wrap;
	word-wrap: break-word;
	overflow-wrap: break-word;
	word-break: normal;
	tab-size: 4;
	-moz-tab-size: 4;
	
	background: transparent;
	color: transparent; /* Text invisible */
	-webkit-text-fill-color: transparent;
	
	resize: none; /* ← Disable resize to keep layers synced */
	outline: none;
	overflow: auto;
	
	caret-color: #0b0c0c; /* Visible caret */
	z-index: 2;
	}

.code-editor__textarea:focus {
	background: rgba(253, 253, 253, 0.3);
	}

.code-editor__textarea::selection {
	background: rgba(29, 112, 184, 0.25);
	}

.code-editor__textarea::-moz-selection {
	background: rgba(29, 112, 184, 0.25);
	}

/* Mustache syntax highlighting - optimized for light background */
.token.mustache {
	color: #c7254e;
	font-weight: 600;
	}

.token.mustache-tag {
	color: #c7254e;
	}

.token.mustache-variable {
	color: #9b59b6;
	font-weight: 500;
	}

.token.keyword {
	color: #3498db;
	font-weight: 600;
	}

.token.comment {
	color: #95a5a6;
	font-style: italic;
	}

/* Markdown syntax - light background optimized */
.token.title {
	color: #2980b9;
	font-weight: 700;
	}

.token.bold {
	font-weight: 700;
	color: #2c3e50;
	}

.token.italic {
	font-style: italic;
	color: #34495e;
	}

.token.code {
	color: #e74c3c;
	background: #f9f2f4;
	padding: 2px 4px;
	border-radius: 3px;
	}

/* Responsive */
@media (max-width: 768px) {
	.code-editor {
		min-height: 300px;
		font-size: 13px;
		}
	
	.code-editor__textarea {
		min-height: 300px;
		}
	}

/* === LIVE PREVIEW STYLES ================================ */

.preview {
	padding: 24px;
	background: white;
	height: var(--guide-source-base-h);
	overflow-y: auto;
	}

/* Remove the placeholder styling when there's content */
.preview:not(:empty) .muted {
	display: none;
	}

/* Typography */
.preview h1 {
	font-size: 2rem;
	font-weight: 700;
	margin: 0 0 1.5rem;
	padding-bottom: 0.5rem;
	border-bottom: 2px solid #b1b4b6;
	color: #0b0c0c;
	line-height: 1.2;
	}

.preview h2 {
	font-size: 1.5rem;
	font-weight: 700;
	margin: 2rem 0 1rem;
	color: #0b0c0c;
	line-height: 1.3;
	}

.preview h3 {
	font-size: 1.25rem;
	font-weight: 700;
	margin: 1.5rem 0 0.75rem;
	color: #0b0c0c;
	line-height: 1.4;
	}

.preview h4 {
	font-size: 1.1rem;
	font-weight: 700;
	margin: 1.25rem 0 0.5rem;
	color: #0b0c0c;
	}

.preview h5,
.preview h6 {
	font-size: 1rem;
	font-weight: 700;
	margin: 1rem 0 0.5rem;
	color: #505a5f;
	}

.preview p {
	margin: 0 0 1rem;
	line-height: 1.6;
	color: #0b0c0c;
	}

.preview p:last-child {
	margin-bottom: 0;
	}

/* Lists */
.preview ul,
.preview ol {
	margin: 0 0 1rem 1.5rem;
	padding: 0;
	}

.preview li {
	margin-bottom: 0.5rem;
	line-height: 1.6;
	}

.preview ul {
	list-style-type: disc;
	}

.preview ol {
	list-style-type: decimal;
	}

.preview ul ul {
	list-style-type: circle;
	margin-top: 0.5rem;
	margin-bottom: 0.5rem;
	}

.preview ol ol,
.preview ul ol {
	list-style-type: lower-alpha;
	margin-top: 0.5rem;
	margin-bottom: 0.5rem;
	}

/* Horizontal rules */
.preview hr {
	border: none;
	border-top: 2px solid #b1b4b6;
	margin: 2rem 0;
	}

/* Blockquotes */
.preview blockquote {
	border-left: 4px solid #1d70b8;
	padding: 1rem 1.5rem;
	margin: 1rem 0;
	background: #f3f2f1;
	color: #505a5f;
	}

.preview blockquote p:last-child {
	margin-bottom: 0;
	}

/* Code */
.preview code {
	background: #f3f2f1;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-family: 'Courier New', monospace;
	font-size: 0.9em;
	color: #d73a49;
	}

.preview pre {
	background: #f6f8fa;
	border: 1px solid #e1e4e8;
	border-radius: 4px;
	padding: 1rem;
	overflow-x: auto;
	margin: 1rem 0;
	}

.preview pre code {
	background: transparent;
	padding: 0;
	color: #0b0c0c;
	font-size: 0.85rem;
	}

/* Tables */
.preview table {
	border-collapse: collapse;
	width: 100%;
	margin: 1rem 0;
	font-size: 0.95rem;
	}

.preview th,
.preview td {
	border: 1px solid #b1b4b6;
	padding: 0.75rem;
	text-align: left;
	}

.preview th {
	background: #f3f2f1;
	font-weight: 700;
	}

.preview tr:nth-child(even) {
	background: #f8f8f8;
	}

/* Links */
.preview a {
	color: #1d70b8;
	text-decoration: underline;
	}

.preview a:hover {
	color: #003078;
	}

.preview a:visited {
	color: #4c2c92;
	}

/* Strong and emphasis */
.preview strong {
	font-weight: 700;
	}

.preview em {
	font-style: italic;
	}

/* Checkboxes (task lists) */
.preview input[type="checkbox"] {
	margin-right: 0.5rem;
	}

.preview li input[type="checkbox"] {
	margin-left: -1.5rem;
	}

/* Images */
.preview img {
	max-width: 100%;
	height: auto;
	margin: 1rem 0;
	border-radius: 4px;
	border: 1px solid #b1b4b6;
	}

/* Definition lists */
.preview dl {
	margin: 1rem 0;
	}

.preview dt {
	font-weight: 700;
	margin-top: 1rem;
	}

.preview dd {
	margin-left: 2rem;
	margin-bottom: 0.5rem;
	}

/* GOV.UK style details/summary */
.preview details {
	margin: 1rem 0;
	}

.preview summary {
	cursor: pointer;
	font-weight: 700;
	color: #1d70b8;
	}

.preview summary:hover {
	color: #003078;
	}

/* Responsive */
@media (max-width: 768px) {
	.code-editor {
		min-height: 300px;
		font-size: 13px;
		}
	
	.code-editor__textarea {
		min-height: 300px;
		}
	
	.preview {
		padding: 16px;
		}
	
	.preview h1 {
		font-size: 1.75rem;
		}
	
	.preview h2 {
		font-size: 1.35rem;
		}
	
	.preview h3 {
		font-size: 1.15rem;
		}
	}

/* Print styles for preview */
@media print {
	.preview {
		padding: 0;
		}
	
	.preview a {
		color: #0b0c0c;
		text-decoration: none;
		}
	
	.preview a::after {
		content: " (" attr(href) ")";
		font-size: 0.8em;
		color: #505a5f;
		}
	}

/* === =LINT OUTPUT ======================================== */
.lint {
	margin-top: 6px;
	min-height: 1.4em;
	font-size: .95rem;
	}

/* === =MENUS (export dropdown) ============================ */
.menu {
	position: relative;
	flex: 0 0 auto;
	}

.menu__list {
	position: absolute;
	top: 100%;
	right: 0;
	z-index: 10;
	min-width: 180px;
	margin: 4px 0 0 0;
	padding: 4px 0;
	background: #fff;
	border: 1px solid var(--guides-border);
	border-radius: 4px;
	box-shadow: 0 4px 18px var(--guides-shadow);
	display: none;
	}

.menu__list[aria-expanded="true"],
.menu[aria-expanded="true"] .menu__list {
	display: block;
	}

.menu__list li {
	list-style: none;
	}

.menu__list button {
	display: block;
	width: 100%;
	text-align: left;
	padding: 8px 12px;
	border: 0;
	background: transparent;
	cursor: pointer;
	}

/* === =DRAWERS ============================================ */
.drawer {
	position: fixed;
	top: 0;
	right: 0;
	width: 360px;
	max-width: 90vw;
	height: 100%;
	background: #fff;
	border-left: 1px solid var(--guides-border);
	box-shadow: -6px 0 18px rgba(0,0,0,.06);
	padding: 16px;
	overflow: auto;
	}

.list-plain {
	list-style: none;
	margin: 8px 0 0 0;
	padding: 0;
	}

.list-plain li + li {
	margin-top: 8px;
	}

.link-like {
	background: none;
	border: 0;
	color: #1d70b8;
	text-decoration: underline;
	cursor: pointer;
	padding: 8px 0;
	}

/* === =FORMS ============================================== */
.form-grid {
	display: grid;
	grid-template-columns: 1fr;
	gap: 8px;
	}

.input {
	border: 1px solid #b1b4b6;
	border-radius: 2px;
	padding: 8px 10px;
	width: 100%;
	box-sizing: border-box;
	}

/* === =RESPONSIVE ========================================= */
@media (max-width: 900px) {
	.editor__split {
		grid-template-columns: 1fr;
		}
	}

@media (max-width: 720px) {
	.editor__toolbar {
		flex-wrap: wrap;
		row-gap: 8px;
		}
	.toolbar-group--right {
		width: 100%;
		justify-content: flex-start;
		}
	#guide-title {
		width: 100%;
		max-width: none;
		}
	}

/* transparency begins in the cascade */
