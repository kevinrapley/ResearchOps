<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Search â€” ResearchOps</title>
	
	<link rel="stylesheet" href="./css/govuk/govuk-typography.css" media="screen" />
	<link rel="stylesheet" href="./css/govuk/govuk-colours.css" media="screen" />
	<link rel="stylesheet" href="./css/screen.css" media="screen" />
	<script type="module" src="./components/layout.js"></script>
</head>

<body>
	<x-include 
		src="./partials/header.html" 
		vars='{
			"active":"Search",
			"subtitle":"Search"
		}'>
	</x-include>

	<div class="card">
		<h2 class="govuk-heading-m">Query</h2>
		<input id="q" class="govuk-input" placeholder="Search text (e.g., contrast, navigation)" />
		<label class="govuk-body">Type
			<select id="type">
				<option value="">Any</option>
				<option>ResearchSession</option>
				<option>Consent</option>
				<option>Note</option>
				<option>Tag</option>
				<option>Cluster</option>
				<option>Theme</option>
			</select>
		</label>
		<button id="go" class="govuk-button">Search</button>
	</div>

	<div class="card">
		<h2 class="govuk-heading-m">Results</h2>
		<div id="results"></div>
	</div>

	<x-include src="./partials/footer.html"></x-include>

	<script type="module">
		import { ResearchOpsSDK } from "../src/sdk/researchops_sdk_v1.0.0.js";
		import { getCtx } from "./scripts/shared.js";
		const sdk = ResearchOpsSDK.createSDK({ ...getCtx() });

		function renderItem(x) {
			const pre = JSON.stringify(x, null, 2);
			const title = x.name || x.description || x.hasBody || x.id;
			return `<div class="result">
    <div class="type">${x.entityType}</div>
    <div class="govuk-body"><strong>${title}</strong></div>
    <details><summary class="govuk-link">Raw</summary><pre>${pre}</pre></details>
  </div>`;
		}

		document.getElementById('go').onclick = async () => {
			const q = document.getElementById('q').value.trim();
			const type = document.getElementById('type').value || undefined;
			const res = await sdk.search({ q, type });
			document.getElementById('results').innerHTML = res.map(renderItem).join("") || '<div class="govuk-hint">No results.</div>';
		};
	</script>
</body>

</html>
